<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container my-5">
    <h1 class="text-center mb-4">Node.js CRUD REST API</h1>

    <!-- Form to Add/Update Item -->
    <div class="card mb-4">
        <div class="card-body">
            <form id="itemForm">
                <input type="hidden" id="itemId">
                <div class="mb-3">
                    <input type="text" id="name" class="form-control" placeholder="Item Name" required>
                </div>
                <div class="mb-3">
                    <input type="number" id="price" class="form-control" placeholder="Price" required>
                </div>
                <div class="mb-3">
                    <input type="text" id="description" class="form-control" placeholder="Description">
                </div>
                <button type="submit" class="btn btn-primary w-100">Save Item</button>
            </form>
        </div>
    </div>

    <!-- Items Table -->
    <div class="card">
        <div class="card-body">
            <table class="table table-bordered table-striped" id="itemsTable">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const apiUrl = '/items';
const itemForm = document.getElementById('itemForm');
const itemsTableBody = document.querySelector('#itemsTable tbody');

let editId = null;

// Load all items
async function loadItems() {
    const res = await fetch(apiUrl);
    const items = await res.json();
    itemsTableBody.innerHTML = '';
    items.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.price}</td>
            <td>${item.description}</td>
            <td>
                <button class="btn btn-sm btn-warning me-1" onclick="editItem('${item._id}')">Edit</button>
                <button class="btn btn-sm btn-danger" onclick="deleteItem('${item._id}')">Delete</button>
            </td>
        `;
        itemsTableBody.appendChild(row);
    });
}

// Add or Update Item
itemForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const itemData = {
        name: document.getElementById('name').value,
        price: document.getElementById('price').value,
        description: document.getElementById('description').value
    };

    if (editId) {
        await fetch(`${apiUrl}/${editId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(itemData)
        });
        editId = null;
    } else {
        await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(itemData)
        });
    }

    itemForm.reset();
    loadItems();
});

// Edit item
async function editItem(id) {
    const res = await fetch(`${apiUrl}/${id}`);
    const item = await res.json();
    document.getElementById('name').value = item.name;
    document.getElementById('price').value = item.price;
    document.getElementById('description').value = item.description;
    editId = id;
}

// Delete item
async function deleteItem(id) {
    if (confirm('Are you sure to delete this item?')) {
        await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
        loadItems();
    }
}

// Initial load
loadItems();
</script>

</body>
</html>
